## CORS

### SOP

- 브라우저는 동일 출처 정책(SOP)를 지켜, 다른 출처의 리소스 접근을 금지하기 때문에, 개발환경이나 Postman을 사용해서 API를 테스트할 때는 잘 되다가, 브라우저 상에서 API를 호출할 때 문제가 발생하는 경우가 있습니다.

- 이 방법은 보안 취약점을 노린 공격을 방어할 수 있지만, 외부 리소스를 사용하지 못하는 문제가 발생합니다.

---

### CORS

- CORS는 앞서 말한 상황에서, 예외적으로 브라우저에서, 외부 리소스에 접근할 수 있는 권한을 부여할 수 있도록 브라우저에 알려주는 정책입니다.

---

### CORS 동작 원리

- 먼저, 웹 애플리케이션이 다른 출처의 리소스에 접근 시, HTTP 프로토콜을 사용해 요청을 보내며, 요청 헤더 내의 origin 필드에 요청을 보내는 출처를 담아 보냅니다.

- 이후, 서버가 이 요청에 대해 응답할 때, 응답 헤더의 **Access-control-allow-origin** 값에 "리소스 접근을 허용할 출처"를 내려주고,
  응답받은 브라우저는 **자신이 보낸 origin과 응답의 Access-control-allow-origin를 비교**해 유효한 응답인지 확인합니다.

---

### 브라우저 상에서 외부 리소스를 사용하는 방법

- 브라우저 상에서 외부 리소스를 사용하기 위해서는, 서버에서 **Access-control-allow-origin 헤더**에 값을 넣어, 브라우저에 응답하는 방식을 사용할 수 있습니다.
    - 이 헤더에 작성된 출처의 페이지에서만, 응답으로 온 리소스 접근이 가능하도록 허용합니다
    - 만약, [*] 와일드카드 작성 시, 어떤 출처의 브라우저든 응답으로 온 모든 리소스에 접근할 수 있게 됩니다.

---

### Preflight Request

- 브라우저가 **요청을 한번에 보내지 않고, 예비요청과 본 요청을 나눠서 서버에 전송**하는 방법입니다.
- 예비요청은 **Preflight**이라 부르고, 이때 **option** 메소드가 사용됩니다.
- 예비요청 때는, 서버가 예비요청에 대한 응답으로 현재 **어떤 요청을 허용하고 금지하는지에 대한 정책정보를 응답헤더에 담아 반환**합니다.
- 이후 본요청때는, 예비요청으로 얻었던 **서버의 응답 내 허용정책**을 비교해 **안전한 요청이라고 판단**한 경우, 브라우저측은 본 요청을 보냅니다.
- 본 요청에 대한 응답을 받으면 브라우저는 최종적으로 응답데이터를 자바스크립트에 넘겨줍니다. 

---

### simple request

- 예비요청 없이 서버에 본 요청을 보낸 후, 서버가 응답 헤더에 **Access-control-allow-origin** 값을 보내면, 브라우저가 CORS 정책 위반을 하였는지 여부를 검사하는 방법입니다.